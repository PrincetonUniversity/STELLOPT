#!/usr/bin/env python3
import sys, ossys.path.insert(0, '../../pySTEL/')
import numpy as np                    #For Arrays
from math import pi
from libstell.libstell import read_vmec

try:
	qtCreatorPath=os.environ["STELLOPT_PATH"]
except KeyError:
	print("Please set environment variable STELLOPT_PATH")
	sys.exit(1)
failtol = 1.0
filename='wout_ATF.nc'
data=read_vmec(filename)
if not data:
    print('ERROR Opening File: '+filename)
    sys.exit(0)
else:
    print('EXTENSION: '+filename)
print('==== Scalars ====')
varlist={}
varlist['aspect']=7.474507825062053
varlist['b0']=3.9807928937611585
varlist['wp']=0.07260689243748131
varlist['betatot']=0.09385810241655983
varlist['volume']=3.132513987601885
lfail = 0;
for temp in varlist:
    act = varlist[temp]
    cal = data[temp]
    perct = 100*(abs(act-cal)/act)
    print('  '+temp+': '+str(cal)+'   '+str(act)+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
print('==== Vectors ====')
varlist={}

#print(data['jcurv'].tolist())

varlist['iotaf']=np.array([[0.35], [0.3551181102362204], [0.3602362204724409], [0.3653543307086614], [0.37047244094488185], [0.37559055118110235], [0.38070866141732285], [0.3858267716535433], [0.39094488188976373], [0.3960629921259842], [0.4011811023622047], [0.40629921259842516], [0.41141732283464566], [0.41653543307086616], [0.4216535433070866], [0.42677165354330704], [0.43188976377952754], [0.43700787401574803], [0.4421259842519685], [0.44724409448818897], [0.4523622047244094], [0.4574803149606299], [0.46259842519685035], [0.46771653543307085], [0.47283464566929134], [0.4779527559055118], [0.4830708661417323], [0.4881889763779527], [0.4933070866141732], [0.4984251968503937], [0.5035433070866142], [0.5086614173228345], [0.5137795275590551], [0.5188976377952756], [0.524015748031496], [0.5291338582677165], [0.5342519685039371], [0.5393700787401574], [0.544488188976378], [0.5496062992125985], [0.5547244094488188], [0.5598425196850394], [0.5649606299212598], [0.5700787401574803], [0.5751968503937008], [0.5803149606299212], [0.5854330708661417], [0.5905511811023623], [0.5956692913385826], [0.6007874015748031], [0.6059055118110237], [0.611023622047244], [0.6161417322834646], [0.6212598425196851], [0.6263779527559055], [0.631496062992126], [0.6366141732283465], [0.6417322834645669], [0.6468503937007875], [0.6519685039370078], [0.6570866141732283], [0.6622047244094488], [0.6673228346456692], [0.6724409448818898], [0.6775590551181102], [0.6826771653543307], [0.6877952755905512], [0.6929133858267715], [0.6980314960629921], [0.7031496062992126], [0.7082677165354331], [0.7133858267716535], [0.7185039370078741], [0.7236220472440944], [0.728740157480315], [0.7338582677165354], [0.7389763779527558], [0.7440944881889764], [0.7492125984251969], [0.7543307086614173], [0.7594488188976378], [0.7645669291338582], [0.7696850393700787], [0.7748031496062993], [0.7799212598425196], [0.7850393700787401], [0.7901574803149607], [0.795275590551181], [0.8003937007874016], [0.8055118110236221], [0.8106299212598426], [0.815748031496063], [0.8208661417322834], [0.8259842519685039], [0.8311023622047244], [0.8362204724409449], [0.8413385826771653], [0.8464566929133859], [0.8515748031496062], [0.8566929133858268], [0.8618110236220473], [0.8669291338582678], [0.8720472440944882], [0.8771653543307087], [0.8822834645669291], [0.8874015748031496], [0.8925196850393701], [0.8976377952755905], [0.9027559055118111], [0.9078740157480315], [0.912992125984252], [0.9181102362204725], [0.9232283464566929], [0.9283464566929134], [0.9334645669291338], [0.9385826771653543], [0.9437007874015748], [0.9488188976377954], [0.9539370078740158], [0.9590551181102362], [0.9641732283464567], [0.9692913385826771], [0.9744094488188977], [0.979527559055118], [0.9846456692913386], [0.9897637795275591], [0.9948818897637796], [0.9999999999999999]])
varlist['presf']=np.array([[1999906.9998139995], [1968658.9373178747], [1937534.8750697502], [1906658.8133176265], [1876030.7520615042], [1845650.6913013826], [1815518.631037262], [1785634.5712691427], [1755998.5119970243], [1726610.4532209062], [1697470.3949407896], [1668578.3371566744], [1639934.27986856], [1611538.223076446], [1583390.1667803333], [1555490.110980222], [1527838.0556761113], [1500434.0008680015], [1473277.9465558932], [1446369.8927397854], [1419709.8394196788], [1393297.7865955732], [1367133.7342674686], [1341217.682435365], [1315549.6310992623], [1290129.5802591606], [1264957.52991506], [1240033.4800669602], [1215357.4307148615], [1190929.3818587638], [1166749.3334986672], [1142817.2856345712], [1119133.2382664764], [1095697.1913943826], [1072509.14501829], [1049569.0991381982], [1026877.0537541074], [1004433.0088660178], [982236.9644739288], [960288.9205778409], [938588.8771777542], [917136.8342736686], [895932.7918655837], [874976.7499534999], [854268.7085374169], [833808.6676173352], [813596.6271932544], [793632.5872651745], [773916.5478330958], [754448.5088970178], [735228.4704569408], [716256.4325128648], [697532.39506479], [679056.3581127162], [660828.3216566434], [642848.2856965713], [625116.2502325005], [607632.2152644307], [590396.1807923616], [573408.1468162936], [556668.1133362267], [540176.0803521607], [523932.0478640957], [507936.0158720317], [492187.9843759688], [476687.95337590686], [461435.9228718459], [446431.8928637858], [431675.8633517267], [417167.83433566854], [402907.80581561144], [388895.7777915555], [375131.75026350043], [361615.72323144646], [348347.69669539336], [335327.6706553412], [322555.6451112901], [310031.62006324006], [297755.595511191], [285727.5714551429], [273947.5478950958], [262415.52483104967], [251131.50226300463], [240095.48019096052], [229307.45861491727], [218767.43753487518], [208475.41695083404], [198431.39686279386], [188635.37727075463], [179087.3581747163], [169787.33957467918], [160735.32147064316], [151931.30386260786], [143375.28675057352], [135067.27013454022], [127007.25401450795], [119195.23839047675], [111631.22326244644], [104315.2086304172], [97247.1944943889], [90427.18085436152], [83855.16771033518], [77531.1550623099], [71455.14291028565], [65627.13125426233], [60047.12009423995], [54715.10943021873], [49631.09926219844], [44795.08959017908], [40207.080414160766], [35867.071734143385], [31775.063550127154], [27931.055862111865], [24335.048670097392], [20987.041974084077], [17887.03577407169], [15035.030070060238], [12431.024862049942], [10075.020150040471], [7967.01593403204], [6107.012214024653], [4495.00899001809], [3131.006262012681], [2015.004030008316], [1147.002294004773], [527.001054002052], [155.00031000048597], [-93.000186000336]])
varlist['jcurv']=np.array([[-333150.6828545786], [-341229.96843920404], [-349309.2540238295], [-362201.88749970234], [-376966.92695998563], [-393763.32449533587], [-406531.3621320556], [-413966.28229014017], [-413981.9853435461], [-409910.60207089566], [-402794.8279659029], [-396129.10963562], [-389184.7845370831], [-383718.3591767382], [-377762.263522785], [-372817.25461732125], [-366932.972800335], [-361955.04546860827], [-356143.78826371493], [-351324.9913430638], [-345897.68764213764], [-341618.74382195633], [-336967.2579767283], [-333338.97757319233], [-329397.2914399678], [-326419.6309094931], [-323235.6797074373], [-320766.8414616457], [-318083.1091438376], [-316030.9237567517], [-313863.6296815697], [-312113.6558845367], [-310240.35551277484], [-308736.3027362616], [-307211.27339033433], [-305899.19432297075], [-304556.42356803466], [-303407.7864768918], [-302320.3233882828], [-301317.37864448485], [-300359.18574128364], [-299482.44059954264], [-298723.82638663263], [-297970.77372263215], [-297316.38750974333], [-296673.91335581965], [-296186.3112659823], [-295659.74192539597], [-295266.2307395244], [-294841.75292315986], [-294591.6186776639], [-294278.9325104519], [-294120.42104307155], [-293907.796630063], [-293877.20987663255], [-293775.7511458619], [-293839.68841696804], [-293838.4196005239], [-294019.95759056567], [-294132.3590628287], [-294414.81229561503], [-294630.7400727025], [-295024.4276031755], [-295357.65039137023], [-295862.94558353093], [-296306.05085493927], [-296917.7108025498], [-297484.1544770649], [-298222.7861702654], [-298907.65481777454], [-299747.881834991], [-300562.06445650104], [-301547.96969007474], [-302490.9616862381], [-303573.120245951], [-304650.86998921854], [-305901.3646741963], [-307121.0547717519], [-308459.49792271527], [-309815.6050791417], [-311347.04099152586], [-312860.2818007826], [-314470.60772113], [-316122.5717263345], [-317957.7099681504], [-319785.65019632835], [-321683.8348196029], [-323644.75166307366], [-325800.0746724032], [-327958.30375715054], [-330156.77837843244], [-332440.02461830253], [-334939.07565411174], [-337448.6199371744], [-339963.72772529745], [-342579.114518211], [-345438.77071188873], [-348312.92244023236], [-351153.6979274202], [-354108.1456933516], [-357351.46802819235], [-360610.0588378474], [-363790.44053733075], [-367088.8261042355], [-370732.1347400954], [-374385.6447887978], [-377910.2281379337], [-381548.25141230883], [-385620.2556155192], [-389688.59065467346], [-393576.6309705328], [-397553.9837750089], [-402072.1501664463], [-406557.1942242693], [-410819.6141019124], [-415113.5775303316], [-420119.58480921225], [-425028.5253260755], [-429698.2724147341], [-434278.22913286905], [-439914.09390346735], [-445354.6579130951], [-450893.5478514654], [-456292.75301616295], [-463644.75598810107], [-472782.2280997586], [-484235.23824230186], [-495688.24838484504]])
for temp in varlist:
    act = varlist[temp]
    cal = data[temp]
    perct = 100*sum(abs(act-cal)/act)
    print('  '+temp+': '+str(cal[0])+'   '+str(act[0])+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
print('==== Arrays =====')
varlist={}
varlist['rmnc']=np.array([0.006629556591673415, 0.004790390641555253,0.0020445335032400623])
varlist['zmns']=np.array([0.006720714483631986,0.0050786789243249435,0.002721139699653576])
varlist['lmns']=np.array([0.04228824295857278,0.021785085159958632,0.008220453593802454])
#varlist['bmnc']=np.array([-0.26069822221636463,-0.16934862521637123,-0.06972576166116973])
for temp in varlist:
    mn  = 4; k   = 16
    act = varlist[temp][0]
    cal = data[temp][k,mn]
    s   = str(k)
    m   = str(int(data['xm'][mn]))
    n   = str(int(data['xn'][mn]))
    perct = 100*abs((act-cal)/act)
    print('  '+temp+'['+s+','+m+','+n+']: '+str(cal)+'   '+str(act)+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
    mn  = 4; k   = 32
    act = varlist[temp][1]
    cal = data[temp][k,mn]
    s   = str(k)
    m   = str(int(data['xm'][mn]))
    n   = str(int(data['xn'][mn]))
    perct = 100*abs((act-cal)/act)
    print('  '+temp+'['+s+','+m+','+n+']: '+str(cal)+'   '+str(act)+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
    mn  = 4; k   = 64
    act = varlist[temp][2]
    cal = data[temp][k,mn]
    s   = str(k)
    m   = str(int(data['xm'][mn]))
    n   = str(int(data['xn'][mn]))
    perct = 100*abs((act-cal)/act)
    print('  '+temp+'['+s+','+m+','+n+']: '+str(cal)+'   '+str(act)+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
print('=================')

if (lfail):
    print('  STATUS: FAIL!!!!!')
else:
    print('  STATUS: PASS')

sys.exit(0)




