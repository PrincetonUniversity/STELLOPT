#!/usr/bin/env python3
import sys, os
sys.path.insert(0, '../../../pySTEL/')
import numpy as np                    #For Arrays
from math import pi
from libstell.stellopt import read_stellopt

try:
	qtCreatorPath=os.environ["STELLOPT_PATH"]
except KeyError:
	print("Please set environment variable STELLOPT_PATH")
	sys.exit(1)

failtol = 1.0
filename='stellopt.BASIC'
data=read_stellopt(filename)
if not data:
    print('ERROR Opening File: '+filename)
    sys.exit(0)

print('STELLOPT_VERSION: ' + str(data['VERSION']))
print('==== Scalars ====')
varlist={}
varlist['ASPECT_equil']=4.365254725961
varlist['BETA_equil']=0.04247495078898
varlist['CURTOR_equil']=-174295.7864085
varlist['PHIEDGE_equil']=0.514386
varlist['RBTOR_equil']=2.31287385883
varlist['R0_equil']=1.577564814145
varlist['VOLUME_equil']=2.978717214537
varlist['WP_equil']=192549.3826145

lfail = 0;
for temp in varlist:
    act = varlist[temp]
    cal = data[temp]
    perct = 100*(abs(act-cal)/act)
    print('  '+temp+': '+str(cal)+'   '+str(act)+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
print('==== Vectors ====')
varlist={}
varlist['NELINE_equil']=np.array([3.95345058e+19, 4.36360683e+19, 4.99104825e+19, 4.97151700e+19,
       4.95198575e+19, 4.98942064e+19, 4.96012377e+19, 4.98942064e+19,
       4.95035814e+19, 4.96988939e+19, 4.97965502e+19, 4.98942064e+19,
       4.98942064e+19, 4.97965502e+19, 4.96175137e+19, 4.93245450e+19,
       4.96988939e+19, 4.99104825e+19, 4.91292325e+19, 4.99104825e+19,
       4.95035814e+19, 4.96988939e+19, 4.94059252e+19, 4.95198575e+19,
       4.99104825e+19, 4.92268887e+19, 4.97965502e+19, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00])
varlist['FARADAY_equil']=np.array([4.84998780e+18, 6.24317187e+18, 8.39064373e+18, 8.14363282e+18,
       7.89449225e+18, 7.64778243e+18, 7.41316933e+18, 7.17963385e+18,
       6.95571009e+18, 6.73951176e+18, 6.51854676e+18, 6.31307331e+18,
       6.10757300e+18, 5.88221215e+18, 5.72549427e+18, 5.51922842e+18,
       5.31235082e+18, 5.16342405e+18, 5.02947813e+18, 4.85267423e+18,
       4.69890718e+18, 4.59685470e+18, 4.35154824e+18, 4.16795625e+18,
       3.75018462e+18, 3.03325623e+18, 1.53056359e+18, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00])
varlist['NE_s']=np.array([1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 0.96957385, 0.84646266, 0.73568288, 0.63801306,
       0.55223125, 0.47629871, 0.40872552, 0.34854282, 0.29505716,
       0.24772617, 0.20610905, 0.16984279, 0.13862508, 0.11219288,
       0.09028815, 0.07261778, 0.05883508, 0.04855828, 0.04140966,
       0.03704126, 0.03510144, 0.03514874, 0.03662914, 0.03897247,
       0.04168458, 0.04436424, 0.04668542, 0.04838872, 0.04928902,
       0.04928902, 0.04838871, 0.0466854 , 0.04436422, 0.04168456,
       0.03897244, 0.03662911, 0.03514871, 0.03510141, 0.03704123,
       0.04140964, 0.04855827, 0.05883507, 0.07261778, 0.09028817,
       0.1121929 , 0.13862512, 0.16984284, 0.20610911, 0.24772625,
       0.29505725, 0.34854292, 0.40872564, 0.47629885, 0.55223141,
       0.63801326, 0.73568311, 0.84646294, 0.96957417, 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ,
       1.5       , 1.5       , 1.5       , 1.5       , 1.5       ])
varlist['PRESS_equil']=np.array([0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.00356007, 0.10317417, 0.27333325, 0.4405629 ,
       0.57717972, 0.68235512, 0.76240732, 0.8236392 , 0.87070981,
       0.90676707, 0.93399534, 0.95408327, 0.96848   , 0.97848388,
       0.98523448, 0.98968045, 0.99255109, 0.99437192, 0.99548419,
       0.99610292, 0.99636549, 0.99635918, 0.99615936, 0.99583395,
       0.99544388, 0.99504027, 0.99467565, 0.99439976, 0.99425121,
       0.99425121, 0.99439976, 0.99467565, 0.99504027, 0.99544389,
       0.99583395, 0.99615936, 0.99635919, 0.9963655 , 0.99610292,
       0.9954842 , 0.99437192, 0.99255109, 0.98968045, 0.98523448,
       0.97848387, 0.96847999, 0.95408324, 0.93399531, 0.90676702,
       0.87070974, 0.8236391 , 0.76240719, 0.68235494, 0.57717947,
       0.44056257, 0.27333285, 0.10317382, 0.00355998, 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ])
varlist['TE_equil']=np.array([   0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,   15.72535141,  471.93466094, 1251.16179877,
       2016.86183312, 2642.32855325, 3123.80103486, 3490.24658493,
       3770.53721693, 3986.01084074, 4151.07586804, 4275.72919465,
       4367.69463013, 4433.60523516, 4479.40053224, 4510.29898452,
       4530.64038085, 4543.77692186, 4552.09961238, 4557.19092162,
       4560.03532475, 4561.23607489, 4561.20724367, 4560.29358245,
       4558.80212399, 4557.00527658, 4555.15370836, 4553.48728126,
       4552.22684386, 4551.54761757, 4551.54762009, 4552.22685118,
       4553.4872927 , 4555.15372296, 4557.00529326, 4558.80214174,
       4560.29360037, 4561.20726105, 4561.23609115, 4560.03533943,
       4557.19093423, 4552.09962206, 4543.77692687, 4530.64037808,
       4510.29896895, 4479.40049662, 4433.6051699 , 4367.6945234 ,
       4275.72903243, 4151.07563383, 3986.01051412, 3770.53677015,
       3490.24597718, 3123.8002062 , 2642.32742509, 2016.86033644,
       1251.15999803,  471.93305271,   15.72497415,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ])
varlist['TI_equil']=np.array([   0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
        419.3295522 , 1399.26565903, 2318.86350702, 3010.40265007,
       3500.70094519, 3850.59735456, 4103.29831952, 4283.67729567,
       4407.31942591, 4486.67775334, 4533.38148369, 4558.2982752 ,
       4570.46635216, 4575.80343379, 4576.95395338, 4574.16622035,
       4565.04416692, 4541.39934793, 4484.19841661, 4363.2706522 ,
       4146.04902532, 3803.27472154, 3297.42472342, 2570.70460722,
       1583.83503038,  480.43382735,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ,
          0.        ,    0.        ,    0.        ,    0.        ])
varlist['BALLOON_grate']=np.array([-0.03990522, -0.04518164, -0.0494775 , -0.04971083, -0.05074736,
       -0.0573415 , -0.06015736, -0.06090567, -0.06153402, -0.06276648,
       -0.06350834, -0.06358018, -0.06444599, -0.0686625 , -0.07489275,
       -0.08117313, -0.08618688, -0.09018186, -0.09306346, -0.09518754,
       -0.0965164 , -0.09723828, -0.09734684, -0.09696629, -0.09622158,
       -0.09536947, -0.09483969, -0.09523124, -0.09709229, -0.10051332,
       -0.10489826, -0.10956414, -0.11387223, -0.11761073, -0.12060108,
       -0.12291505, -0.12448427, -0.12540642, -0.12562028, -0.12521477,
       -0.12413147, -0.12245412, -0.12014725, -0.11730966, -0.11398747,
       -0.11045001, -0.10715209, -0.10495739, -0.10488095, -0.10761541,
       -0.11300195, -0.12003461, -0.12745773, -0.13430544, -0.14010697,
       -0.14464713, -0.14803223, -0.15026516, -0.15162906, -0.15213036,
       -0.15211251, -0.15147167, -0.15057178, -0.14922869, -0.14782754,
       -0.14599961, -0.14414553, -0.14203976, -0.13974788, -0.13723878,
       -0.13481565, -0.13196189, -0.12974734, -0.12743523, -0.12686892,
       -0.12538196, -0.12473499, -0.11769686, -0.11060464, -0.08907185,
       -0.07101456,  0.02692876,  0.06124561,  0.09033339,  0.08985875,
        0.0850165 ,  0.04413507, -0.05680148, -0.07107962,  0.04761966,
        0.07757839, -0.08986066, -0.13631851, -0.14806962, -0.15080767,
       -0.14896531, -0.14438368,  0.        ])
varlist['BOOTSTRAP_equil']=np.array([3.85718780e+03, 1.51673234e+04, 1.85012176e+04, 2.41980280e+04,
       2.92562402e+04, 3.18460059e+04, 2.04026861e+04, 1.23054894e+05,
       8.75165889e+04, 9.01672796e+04, 9.66660274e+04, 1.05872690e+05,
       1.14200446e+05, 1.25481331e+05, 1.36315634e+05, 1.45948802e+05,
       1.65810560e+05, 1.72263029e+05, 1.83355166e+05, 1.92387658e+05,
       2.16825289e+05, 2.24590433e+05, 2.36393629e+05, 2.48683954e+05,
       2.61566520e+05, 2.72901408e+05, 2.84612241e+05, 2.94218294e+05,
       3.00934288e+05, 3.21790791e+05, 3.30871879e+05, 3.38792509e+05,
       3.47458745e+05, 3.57107508e+05, 3.69484009e+05, 3.77114861e+05,
       3.76393464e+05, 3.97977418e+05, 4.00242758e+05, 4.42188237e+05,
       4.26086757e+05, 4.52142268e+05, 4.53617500e+05, 4.54063144e+05,
       4.78105281e+05, 4.30076096e+05, 4.01979266e+05, 3.71379297e+05,
       3.63535343e+05, 3.04100698e+05, 4.05152059e+05, 3.08347956e+05,
       2.41084045e+05, 2.61893416e+05, 1.60376714e+05, 1.18800097e+05,
       3.12960167e+04, 9.47938496e+04, 3.04688074e+05, 7.03386988e+05,
       1.70773847e+06, 6.95203950e+06, 3.93208364e+06, 2.05327097e+06,
       1.47152028e+06, 1.19620236e+06, 1.02414199e+06, 9.17540704e+05,
       8.46111889e+05, 7.14997490e+05, 7.04187119e+05, 5.91587301e+05,
       6.73049795e+05, 5.74466774e+05, 5.22471489e+05, 3.92249811e+05,
       7.23543333e+05, 5.46439403e+05, 4.70307980e+05, 4.21811031e+05,
       4.08608323e+05, 3.82927636e+05, 3.39154185e+05, 3.24220776e+05,
       2.88983266e+05, 2.61852738e+05, 2.33963543e+05, 2.06567246e+05,
       1.81422825e+05, 1.58247150e+05, 1.37226695e+05, 1.18073624e+05,
       1.00134878e+05, 8.26981795e+04, 6.48743695e+04, 2.93854222e+04,
       1.66634282e+01, 3.23192605e+00])
varlist['NEO_equil']=np.array([1.63413710e-07, 9.80975460e-08, 1.40018104e-07, 2.23263416e-07,
       3.34833150e-07, 4.77100154e-07, 6.54455270e-07, 8.46328241e-07,
       1.10627654e-06, 1.40112674e-06, 1.73987339e-06, 2.07047000e-06,
       2.49976706e-06, 2.95859091e-06, 3.52409362e-06, 4.10077533e-06,
       4.78950967e-06, 5.55386606e-06, 6.17144255e-06, 7.25163813e-06,
       8.16573216e-06, 9.23759340e-06, 1.04274761e-05, 1.17103325e-05,
       1.29735882e-05, 1.42241588e-05, 1.61575153e-05, 1.78712398e-05,
       1.97005177e-05, 2.17053611e-05, 2.46114404e-05, 2.66004016e-05,
       2.95497981e-05, 3.24869797e-05, 3.54516205e-05, 3.92841807e-05,
       4.29363015e-05, 4.66599832e-05, 5.07656932e-05, 5.55192183e-05,
       6.01255823e-05, 6.51884285e-05, 7.12579480e-05, 7.70544973e-05,
       8.39062275e-05, 9.02668765e-05, 9.74049299e-05, 1.05035996e-04,
       1.13637852e-04, 1.22301898e-04, 1.31255686e-04, 1.41376396e-04,
       1.51408537e-04, 1.63833654e-04, 1.75001106e-04, 1.87333892e-04,
       2.00188832e-04, 2.13000910e-04, 2.26868016e-04, 2.42305667e-04,
       2.58025140e-04, 2.75317541e-04, 2.91705716e-04, 3.11310184e-04,
       3.28606707e-04, 3.46704664e-04, 3.66149088e-04, 3.89828481e-04,
       4.12562562e-04, 4.36199326e-04, 4.61269781e-04, 4.87136470e-04,
       5.11665886e-04, 5.44143759e-04, 5.73673866e-04, 6.06906606e-04,
       6.44264622e-04, 6.82322008e-04, 7.21182448e-04, 7.62235381e-04,
       8.11181931e-04, 8.60175932e-04, 9.08288729e-04, 9.69578735e-04,
       1.02774625e-03, 1.09225976e-03, 1.16468775e-03, 1.24113111e-03,
       1.31051497e-03, 1.39311746e-03, 1.49768512e-03, 1.58641325e-03,
       1.67897462e-03, 1.79730056e-03, 1.89253483e-03, 2.01038413e-03,
       2.12641224e-03, 2.26630404e-03])
varlist['TXPORT_equil']=np.array([0.09589212, 0.09667091, 0.095876  , 0.09536677, 0.09626293,
       0.0979782 , 0.09970561, 0.10079448, 0.09998995, 0.09477011,
       0.0906425 , 0.08752357, 0.08491442, 0.08499796, 0.0914881 ])
for temp in varlist:
    act = varlist[temp]
    cal = data[temp]
    div = np.where(act==0,1,act)
    perct = 100*sum(abs(act-cal)/div)
    print('  '+temp+': '+str(cal[0])+'   '+str(act[0])+'   '+str(int(perct))+'%')
    if perct > failtol:
        lfail = 1
print('=================')

if (lfail):
    print('  STATUS: FAIL!!!!!')
else:
    print('  STATUS: PASS')

sys.exit(0)




