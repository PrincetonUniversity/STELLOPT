!-----------------------------------------------------------------------
!     Subroutine:    gaunt_freefree
!     Authors:       S. Lazerson (samuel.lazerson@ipp.mpg.de)
!     Date:          04/18/2021
!     Description:   This subroutine returns the Gaunt Free_Free Factor
!                    <g_{ff}> based on the paper
!                    Sutherland, R. S. (1998). Accurate free-free Gaunt
!                         factors for astrophysical plasmas. Monthly 
!                         Notices of the Royal Astronomical Society, 
!                         300(2), 321â€“330. 
!                        http://doi.org/10.1046/j.1365-8711.1998.01687.x
!                    It is based on interpolation provided for Table 3.
!                    It takes argument x which is gamma^2 where
!                        gamma^2=Z*Z*Ry/(k*T)
!-----------------------------------------------------------------------
      SUBROUTINE gaunt_freefree(x,gff)
!-----------------------------------------------------------------------
!     Libraries NONE
!-----------------------------------------------------------------------
!-----------------------------------------------------------------------
!     Arguments
!          x			   Gamma^2=Z*Z*Ry/(k*T)
!          gff          Interpolated Gaunt Free-Free Factor
!-----------------------------------------------------------------------
      IMPLICIT NONE
      REAL, INTENT(in) :: x
      REAL, INTENT(out) :: gff
!-----------------------------------------------------------------------
!     PARAMETERS
!          table_log_g2     log(gamm^2) Table 3 Column
!          table_gff0       <gff(gamm^2)> Table 3 Column
!          table_s1         s1 Table 3 Column
!          table_s2         s2 Table 3 Column
!          table_s3         s3 Table 3 Column
!-----------------------------------------------------------------------
      REAL, PARAMETER, DIMENSION(41) :: table_log_g2 = (/-4.00,&
            -3.80, -3.60, -3.40, -3.20, -3.00,&
            -2.80, -2.60, -2.40, -2.20, -2.00,&
            -1.80, -1.60, -1.40, -1.20, -1.00,&
            -0.80, -0.60, -0.40, -0.20,  0.00,&
             0.20,  0.40,  0.60,  0.80,  1.00,&
             1.20,  1.40,  1.60,  1.80,  2.00,&
             2.20,  2.40,  2.60,  2.80,  3.00,&
             3.20,  3.40,  3.60,  3.80,  4.00/)
      REAL, PARAMETER, DIMENSION(41) :: table_gff0 = (/1.113888,&
             1.11698, 1.12089, 1.12581, 1.13200, 1.13975,&
             1.14945, 1.16149, 1.17635, 1.19447, 1.21622,&
             1.24182, 1.27104, 1.30328, 1.33711, 1.37040,&
             1.40029, 1.42365, 1.43768, 1.44060, 1.43220,&
             1.41391, 1.38830, 1.35832, 1.32658, 1.29496,&
             1.26462, 1.23618, 1.20993, 1.18594, 1.16421,&
             1.14464, 1.12711, 1.11147, 1.09757, 1.08526,&
             1.07438, 1.06481, 1.05640, 1.04904, 1.04264/)
      REAL, PARAMETER, DIMENSION(41) :: table_s1 = (/1.3480E-2,&
         1.7446E-2, 2.1857E-2, 2.7532E-2, 3.4575E-2, 4.3297E-2,&
         5.3985E-2, 6.6876E-2, 8.2085E-2, 9.9394E-2, 1.1839E-1,&
         1.3738E-1, 1.5444E-1, 1.6668E-1, 1.6990E-1, 1.6049E-1,&
         1.3571E-1, 9.5483E-2, 4.3235E-2,-1.4231E-2,-6.8479E-2,&
        -1.1216E-1,-1.4136E-1,-1.5619E-1,-1.5966E-1,-1.5561E-1,&
        -1.4730E-1,-1.3688E-1,-1.2561E-1,-1.1424E-1,-1.0317E-1,&
        -9.2649E-2,-8.2810E-2,-7.3722E-2,-6.5401E-2,-5.7838E-2,&
        -5.1006E-2,-4.4857E-2,-3.9313E-2,-3.4368E-2,-2.9645E-2/)
      REAL, PARAMETER, DIMENSION(41) :: table_s2 = (/1.0471E-2,&
         9.3580E-3, 1.2697E-2, 1.5679E-2, 1.9537E-2, 2.4074E-2,&
         2.9365E-2, 3.5089E-2, 4.0955E-2, 4.5592E-2, 4.9376E-2,&
         4.5579E-2, 3.9733E-2, 2.1465E-2,-5.3674E-3,-4.1695E-2,&
        -8.2176E-2,-1.1898E-1,-1.4226E-1,-1.4507E-1,-1.2617E-1,&
        -9.2232E-2,-5.3753E-2,-2.0429E-2, 3.0930E-3, 1.7133E-2,&
         2.4447E-2, 2.7653E-2, 2.8668E-2, 2.8225E-2, 2.7109E-2,&
         2.5490E-2, 2.3708E-2, 2.1728E-2, 1.9877E-2, 1.7938E-2,&
         1.6221E-2, 1.4528E-2, 1.3191E-2, 1.1531E-2, 0.0000E+0/)
      REAL, PARAMETER, DIMENSION(41) :: table_s3 = (/-1.8550E-3,&
         5.5649E-3, 4.9703E-3, 6.4291E-3, 7.5631E-3, 8.8183E-3,&
         9.5387E-3, 9.7768E-3, 7.7293E-3, 6.3059E-3,-6.3279E-3,&
        -9.7441E-3,-3.0446E-2,-4.4721E-2,-6.0547E-2,-6.7467E-2,&
        -6.1337E-2,-3.8810E-2,-4.6719E-3, 3.1496E-2, 5.6562E-2,&
         6.4131E-2, 5.5540E-2, 3.9204E-2, 2.3401E-2, 1.2190E-2,&
         5.3426E-3, 1.6914E-3,-7.3803E-4,-1.8602E-3,-2.6986E-3,&
        -2.9690E-3,-3.2997E-3,-3.0851E-3,-3.2325E-3,-2.8614E-3,&
        -2.8212E-3,-2.2283E-3,-2.7669E-3, 9.2231E-4, 0.0000E+0/)
!-----------------------------------------------------------------------
!     Variables
!          idex         Index for spline tables
!          xlog10       log10(x)
!          delta			Parameterization log(x)-log(gamma^2)
!-----------------------------------------------------------------------
      INTEGER :: idex
      REAL :: delta, xlog10
!-----------------------------------------------------------------------
!     Begin Subroutine
!-----------------------------------------------------------------------
      gff=0.0
      ! Intializations
      xlog10 = log10(x)
      idex = MAX(MIN(COUNT(table_log_g2<xlog10),1),41)
      delta = xlog10 - table_gff0(idex)
      gff = ( ( delta * table_s3(idex) + table_s2(idex) ) * delta + &
                                         table_s1(idex) ) * delta + &
           + table_gff0(idex)
      RETURN

!-----------------------------------------------------------------------
!     End Subroutine
!-----------------------------------------------------------------------    
      END SUBROUTINE gaunt_freefree